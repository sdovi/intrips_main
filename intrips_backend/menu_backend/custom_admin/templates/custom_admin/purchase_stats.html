{% extends 'custom_admin/base.html' %}

{% block content %}
<style>

</style>

<h1 class="text-2xl font-bold mb-4 text-center">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤</h1>

<!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –¥–µ–Ω—å–≥–∞–º -->
<div class="text-center mb-6">
  <a href="{% url 'money_stats' shop.website_url %}" 
     class="money-stats-button">
    üí∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–µ–Ω—å–≥–∞–º
  </a>
</div>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ -->
<div class="flex justify-center mb-6">
  <div class="w-80 md:w-96">
    <canvas id="serviceChart"></canvas>
  </div>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ -->
<div class="overflow-x-auto">
  <table class="w-full border border-gray-300 text-sm md:text-base">
    <thead class="bg-gray-100 text-left">
      <tr>
        <th class="border px-4 py-2">–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏</th>
        <th class="border px-4 py-2">–î–∞—Ç–∞</th>
        <th class="border px-4 py-2">–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</th>
        <th class="border px-4 py-2">–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è</th>
        <th class="border px-4 py-2">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π</th>
        <th class="border px-4 py-2">–°—Ç–∞—Ç—É—Å</th>
      </tr>
    </thead>
    <tbody>
      {% for booking in bookings %}
      <tr class="hover:bg-gray-50">
        <td class="border px-4 py-2">{{ booking.service_name }}</td>
        <td class="border px-4 py-2">{{ booking.date }}</td>
        <td class="border px-4 py-2">{{ booking.start_time }}</td>
        <td class="border px-4 py-2">{{ booking.end_time|default:"‚Äî" }}</td>
        <td class="border px-4 py-2 text-center">{{ booking.guest_count }}</td>
        <td class="border px-4 py-2 font-semibold {% if booking.status_text == '–í—ã–ø–æ–ª–Ω–µ–Ω' %}text-green-600{% elif booking.status_text == '–û—Ç–º–µ–Ω–µ–Ω' %}text-red-600{% else %}text-yellow-600{% endif %}">
          {{ booking.status_text }}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center py-4 text-gray-500">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const serviceData = JSON.parse('{{ stats_json|escapejs }}');
    const ctx = document.getElementById('serviceChart').getContext('2d');

    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: Object.keys(serviceData),
        datasets: [{
          data: Object.values(serviceData),
          backgroundColor: ['#FF6384', '#36A2EB', '#4BC0C0'],
          hoverOffset: 10
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: true,
            position: 'bottom'
          }
        }
      }
    });
  });
</script>
{% endblock %}
