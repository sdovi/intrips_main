{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'styles.css' %}">
    <style>


      .logo__left_nav img{
        width: 100%;
        max-width: 200px;
        margin-bottom: 25px;
    }
    
    

.section-title {
  font-size: 12px;
  font-weight: bold;
  color: #999;
  margin: 10px 0 ;
  text-transform: uppercase;
  padding-left: 5px;
}
      .hidden {
        display: none;
      }
      
        @font-face {
            font-family: 'TT Firs Neue Regular';
            src: url('{% static "fonts/TT_Firs_Neue_Trial_Regular.ttf" %}') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        
        @font-face {
            font-family: 'TT Firs Neue DemiBold';
            src: url('{% static "fonts/TT_Firs_Neue_Trial_DemiBold.ttf" %}') format('truetype');
            font-weight: bold;
            font-style: normal;
        }
        
        * {
            font-family: 'TT Firs Neue DemiBold', sans-serif;
        }




@media (max-width: 768px) {
    /* –ß–∞—Ç-–∫–Ω–æ–ø–∫–∞ */
    .chat-toggle {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 50%;
        font-size: 18px;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        z-index: 1001;
    }

    /* –ß–∞—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç */
    .chat-box {
        position: fixed;
        bottom: 80px;
        right: 10px;
        width: 90%;
        max-width: 350px;
        background: white;
        padding: 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        display: none;
        z-index: 1000;
    }

    /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á–∞—Ç, –∫–æ–≥–¥–∞ –∞–∫—Ç–∏–≤–µ–Ω */
    .chat-box.active {
        display: block;
    }
  
}
/* –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã */
.blue { background: linear-gradient(45deg, #28a745, #a8e063); }
.purple { background: linear-gradient(45deg, #6f42c1, #b23cf7); }
.green { background: linear-gradient(45deg, #28a745, #a8e063); }

/* –ê–Ω–∏–º–∞—Ü–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ */
@keyframes gradientAnimation {
    0% { background-position: left; }
    100% { background-position: right; }
}


    </style>    
</head>

<body class="bg-gray-100">
    

    <!-- –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–º –º–µ–Ω—é -->
    <div class="overlay" id="overlay"></div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="sidebar" id="sidebar">
        <div class="logo__left_nav">
            <img src="{% static 'img/logo_main.svg' %}" alt="inTrips Logo" />
        </div>
        
        <nav>
          <a href="{% url 'orders_view' shop.website_url %}" class="menu-item active">
            <i class="fas fa-chart-line"></i>
            <span>–ó–∞–∫–∞–∑—ã —Å —Å–∞–π—Ç–∞</span>
            {% if new_orders_count > 0 %}
                <span style="background-color: red; color: white; padding: 4px 8px; border-radius: 999px; margin-left: 20px;" class="badge">
                    {{ new_orders_count }}
                </span>
            {% endif %}
        </a>
        
            

            <div class="section-title">–ö–ª–∏–µ–Ω—Ç—ã</div>
            <a href="{% url 'bookings_list' shop.website_url %}" class="menu-item">
                <i class="fas fa-cogs"></i>
                <span>–£—Å–ª—É–≥–∏</span>
            </a>
            
            <a href="{% url 'order_calendar' shop.website_url  %}" class="menu-item">
                <i class="fas fa-calendar-alt"></i>
                <span>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞–∫–∞–∑–æ–≤</span>
            </a>
            <a href="{% url 'chat_page' shop.website_url %}" class="menu-item">
              <i class="fas fa-comments"></i>
              <span class="chats_nav">–ß–∞—Ç —Å –≥–æ—Å—Ç–µ–º</span>
              <span id="unreadMessagesCount" class="badge hidden" style="background-color: red; color: white; padding: 4px 8px; border-radius: 999px; margin-left: 20px;">
              </span>
            </a>
            
            <div class="section-title">–ü–µ—Ä—Å–æ–Ω–∞–ª</div>
            <a href="{% url 'task_list' shop.website_url  %}" class="menu-item">
                <i class="fas fa-tasks"></i>
                <span>–ó–∞–¥–∞—á–∏</span>
                {% comment %} <span class="badge">2</span> {% endcomment %}
            </a>
            <a href="{% url 'employees' shop.website_url %}" class="menu-item">
                <i class="fas fa-users"></i>
                <span>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</span>
            </a>
            
            

            <div class="section-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <a href="{% url 'purchase_stats' shop.website_url %}" class="menu-item">
                <i class="fas fa-chart-bar"></i>
                <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—É–ø–æ–∫</span>
            </a>
            <a href="{% url 'archive_list'  shop.website_url %}" class="menu-item">
                <i class="fas fa-archive"></i>
                <span>–ê—Ä—Ö–∏–≤</span>
            </a>


            <div class="section-title">–í–∏—Ç—Ä–∏–Ω–∞</div>
            <a href="{% url 'edit_shop' shop.website_url %}" class="menu-item">
                <i class="fas fa-cogs"></i>
                <span>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω</span>
            </a>
            
        </nav>

    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="content">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="navbar">
            <button class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            {% comment %} <input type="text" class="form-control" placeholder="–ü–æ–∏—Å–∫ —É—Å–ª—É–≥–∏ –∏–ª–∏ –∑–∞—è–≤–∫–∏"> {% endcomment %}


{% if user.is_authenticated %}
    <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∞–¥–º–∏–Ω–∫—É -->
    
        <h5>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!</h5>
 
{% else %}
    <script>window.location.href = "{% url 'login' %}";</script>
{% endif %}

          <div>
            <button class="btn btn-success btn-primary ms-2 nav__create_usluga"> <a href="{% url 'add_task' %}"><i class="fas fa-archive me-2"></i>–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</a></button>
            <button class="btn btn-primary ms-2 nav__create_usluga">
                <a href="{% url 'booking_create' %}"  >–°–æ–∑–¥–∞—Ç—å —É—Å–ª—É–≥—É</a>
            </button>
          </div>
            
        </div>



        
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞—è–≤–æ–∫ -->
        <div class="status-cards mt-4">
            {% comment %} <div class="status-card blue">
                <h5>–ó–∞—è–≤–∫–∞ ‚Ññ18</h5>
                <p>–°—Ç–∞—Ç—É—Å: –í –æ–±—Ä–∞–±–æ—Ç–∫–µ</p>
                <p><strong>10:00 —Å–µ–≥–æ–¥–Ω—è</strong></p>
            </div>
            <div class="status-card purple">
                <h5>–ó–∞—è–≤–∫–∞ ‚Ññ19</h5>
                <p>–°—Ç–∞—Ç—É—Å: –û–∂–∏–¥–∞–Ω–∏–µ</p>
                <p><strong>10:15 —Å–µ–≥–æ–¥–Ω—è</strong></p>
            </div>
            <div class="status-card green">
                <h5>–ó–∞—è–≤–∫–∞ ‚Ññ20</h5>
                <p>–°—Ç–∞—Ç—É—Å: –ó–∞–≤–µ—Ä—à–µ–Ω–æ</p>
                <p><strong>–ö–æ–º–∞–Ω–¥–∞ 13</strong></p>
            </div> {% endcomment %}
        </div>
 <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç - –ß–∞—Ç -->
 <div class="container mx-auto p-6">
    <div class="bg-white rounded-lg shadow p-6">
      <h1 class="text-2xl font-bold mb-4">–ß–∞—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h1>
      <button id="unanswered" class="bg-blue-500 text-white px-4 py-2 rounded">
        –ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ
      </button>
      <div id="messages" class="space-y-4 mt-4">
        <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å—é–¥–∞ -->
      </div>
    </div>
  </div>

  <!-- –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π -->
  <div class="fixed bottom-4 right-4 bg-white p-4 shadow-lg rounded-lg w-80">
    <label for="userIdInput" class="block text-gray-700 font-bold mb-2">User ID:</label>
    <input id="userIdInput" type="text" class="w-full px-4 py-2 border rounded mb-4" placeholder="–í–≤–µ–¥–∏—Ç–µ User ID" readonly />
    <label for="messageInput" class="block text-gray-700 font-bold mb-2">–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
    <textarea id="messageInput" rows="4" class="w-full px-4 py-2 border rounded mb-4" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"></textarea>
    <button id="sendMessageBtn" class="bg-blue-500 text-white px-4 py-2 rounded w-full">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>
</div>



    <script src="https://kit.fontawesome.com/5ac26fc84a.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css">
    


    {% comment %} –º–µ–¥–∏—è {% endcomment %}
    <script>

        document.addEventListener("DOMContentLoaded", function () {
            const chatToggle = document.createElement("button");
            chatToggle.className = "chat-toggle";
            chatToggle.innerHTML = "üí¨";
            document.body.appendChild(chatToggle);
        
            const chatBox = document.querySelector(".fixed.bottom-4.right-4"); // –ß–∞—Ç-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            chatBox.classList.add("chat-box");
        
            chatToggle.addEventListener("click", function () {
                chatBox.classList.toggle("active");
            });
        });
        

    </script>
    <script>
        $(document).ready(function(){
            $("#date").datepicker({ dateFormat: "yy-mm-dd" });
        });
    </script>
    <script>
      $(document).ready(function () {
          let employeeData = {};
          let shopUrl = "{{ shop.website_url }}";  // ‚úÖ –ü–æ–ª—É—á–∞–µ–º URL –º–∞–≥–∞–∑–∏–Ω–∞
  
          function fetchEmployees(callback) {
              $.ajax({
                  url: "/api/employees/" + shopUrl + "/",
                  method: "GET",
                  dataType: "json",
                  success: function (data) {
                      data.forEach(employee => {
                          employeeData[employee.id] = employee.full_name;
                      });
                      callback();
                  },
                  error: function () {
                      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤");
                      callback();
                  }
              });
          }
  
          function fetchBookings() {
              $.ajax({
                  url: "/api/bookings/" + shopUrl + "/",  // ‚úÖ –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –º–∞–≥–∞–∑–∏–Ω—É
                  method: "GET",
                  dataType: "json",
                  success: function (data) {
                      let latestBookings = data.sort((a, b) => b.id - a.id).slice(0, 3);
                      $(".status-cards").empty();
  
                      let statusLabels = {
                          1: { text: "–í —Ä–∞–±–æ—Ç–µ", color: "blue" },
                          2: { text: "–í—ã–ø–æ–ª–Ω–µ–Ω–æ", color: "purple" },
                          3: { text: "–û—Ç–º–µ–Ω–µ–Ω", color: "green" }
                      };
  
                      latestBookings.forEach(booking => {
                          let statusInfo = statusLabels[booking.status] || { text: "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ", color: "gray" };
                          let formattedDate = new Date(booking.date).toLocaleDateString("ru-RU");
  
                          let employeeName = employeeData[booking.employee] || "–ù–µ —É–∫–∞–∑–∞–Ω";
                          let roomNumber = booking.room_number || "–ù–µ —É–∫–∞–∑–∞–Ω–∞";
  
                          let cardHtml = `
                              <div class="status-card ${statusInfo.color}">
                                  <h5 class='mb-1'>–ó–∞–∫–∞–∑ ‚Ññ${booking.id}</h5>
                                  <p class='mb-1'>–£—Å–ª—É–≥–∞: <strong>${booking.service_name}</strong></p>
                                  <p class='mb-1'>–°—Ç–∞—Ç—É—Å: ${statusInfo.text}</p>
                                  {% comment %} <p class='mb-1'>–°–æ—Ç—Ä—É–¥–Ω–∏–∫: <strong>${employeeName}</strong></p> {% endcomment %}
                                  <p class='mb-1'>–ù–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã: <strong>${roomNumber}</strong></p>
                                  <p class='mb-1'><strong>${booking.start_time} | ${formattedDate}</strong></p>
                              </div>
                          `;
                          $(".status-cards").append(cardHtml);
                      });
                  },
                  error: function (error) {
                      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫:", error);
                  }
              });
          }
  
          fetchEmployees(fetchBookings);
          setInterval(fetchBookings, 30000);
      });
  </script>
    
    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—É—Ä–≥–µ—Ä-–º–µ–Ω—é -->
    <script>
        document.getElementById("menu-toggle").addEventListener("click", function() {
            document.getElementById("sidebar").classList.toggle("open");
            document.getElementById("overlay").classList.toggle("show");
        });

        document.getElementById("overlay").addEventListener("click", function() {
            document.getElementById("sidebar").classList.remove("open");
            document.getElementById("overlay").classList.remove("show");
        });
    </script>

     <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è —á–∞—Ç–∞ -->
  <script>
    // –ü–æ–ª—É—á–∞–µ–º shopUrl –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è shop –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω–∞ –≤ —à–∞–±–ª–æ–Ω)
    const shopUrl = "{{ shop.website_url }}";
    const messagesContainer = document.getElementById('messages');
    const unansweredBtn = document.getElementById('unanswered');
    const userIdInput = document.getElementById('userIdInput');
    const messageInput = document.getElementById('messageInput');
    const sendMessageBtn = document.getElementById('sendMessageBtn');
    const unreadMessagesBadge = document.getElementById('unreadMessagesCount');
    let showUnanswered = false;
    let selectedMessageId = null;
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ CSRF-—Ç–æ–∫–µ–Ω–∞
    function getCSRFToken() {
      const cookies = document.cookie.split(';');
      for (let cookie of cookies) {
        cookie = cookie.trim();
        if (cookie.startsWith('csrftoken=')) {
          return cookie.substring('csrftoken='.length);
        }
      }
      return null;
    }
    const csrfToken = getCSRFToken();
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
    async function fetchMessages() {
      // –§–æ—Ä–º–∏—Ä—É–µ–º URL —Å —É—á–µ—Ç–æ–º –ø—Ä–µ—Ñ–∏–∫—Å–∞ "chat/"
      const url = `/chat/${shopUrl}/messages/?unanswered=${showUnanswered}`;
      console.log('Fetching messages from:', url);
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π: ${response.statusText}`);
        const messages = await response.json();
        console.log('Messages received:', messages);
        messagesContainer.innerHTML = messages.map(msg => `
          <div class="p-2 ${msg.is_admin ? 'text-right' : 'text-left'}">
            <p class="p-2 rounded ${msg.is_admin ? 'bg-blue-100' : 'bg-gray-200'}">
              <strong>${msg.is_admin ? 'Admin' : msg.user_id}</strong>: ${msg.message}
            </p>
            <small class="text-gray-500">${new Date(msg.timestamp).toLocaleString()}</small>
            ${msg.is_admin ? '' : `<button class="text-blue-500 underline reply-btn" data-id="${msg.id}" data-user="${msg.user_id}">–û—Ç–≤–µ—Ç–∏—Ç—å</button>`}
          </div>
        `).join('');
        document.querySelectorAll('.reply-btn').forEach(button => {
          button.addEventListener('click', (event) => {
            selectedMessageId = event.target.dataset.id;
            userIdInput.value = event.target.dataset.user;
            messageInput.focus();
          });
        });
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π:', error);
      }
    }
    
    async function fetchUnreadCount() {
      const url = `/chat/${shopUrl}/unread_count/`;
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏–π");
    
        const data = await response.json();
        const unreadCount = data.unread_count;
        const unreadMessagesBadge = document.getElementById("unreadMessagesCount");
    
        if (unreadCount > 0) {
          unreadMessagesBadge.textContent = unreadCount; // –°—Ç–∞–≤–∏–º —á–∏—Å–ª–æ
          unreadMessagesBadge.classList.remove("hidden"); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–µ–π–¥–∂
        } else {
          unreadMessagesBadge.classList.add("hidden"); // –ü—Ä—è—á–µ–º –±–µ–π–¥–∂
          unreadMessagesBadge.textContent = ""; // –û—á–∏—â–∞–µ–º —Ç–µ–∫—Å—Ç —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ "0"
        }
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:", error);
      }
    }
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    sendMessageBtn.addEventListener('click', async () => {
      const recipientId = userIdInput.value.trim();
      const message = messageInput.value.trim();
      if (!recipientId || !message) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.');
        return;
      }
      const payload = {
        user_id: recipientId,
        message: message,
        is_admin: true,
        replied_to: selectedMessageId || null,
      };
      try {
        const response = await fetch(`/chat/${shopUrl}/messages/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken,
          },
          body: JSON.stringify(payload),
        });
        if (response.ok) {
          userIdInput.value = '';
          messageInput.value = '';
          selectedMessageId = null;
          fetchMessages();
          fetchUnreadCount();
        } else {
          const error = await response.json();
          alert(`–û—à–∏–±–∫–∞: ${error.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ.'}`);
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
      }
    });
    
    // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Å—á—ë—Ç—á–∏–∫–∞
    setInterval(() => {
      fetchMessages();
      fetchUnreadCount();
    }, 10000);
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ / –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ"
    unansweredBtn.addEventListener('click', () => {
        showUnanswered = !showUnanswered; // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        fetchMessages(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
    
        // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è
        unansweredBtn.textContent = showUnanswered ? "–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ" : "–ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ";
    });
  
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    fetchMessages();
    fetchUnreadCount();
  </script>
</body>
</html>
